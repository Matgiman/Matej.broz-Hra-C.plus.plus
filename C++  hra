#include <iostream>
#include <cstdlib> // Tato knihovna obsahuje funkci rand(), která generuje pseudonáhodné číslo, které potřebujeme v kódu. Dále obsahuje například srand() pro nastavení generátoru náhodných čísel.
#include <ctime>  // Tato knihovna poskytuje funkci time(), kterou používá v kombinaci s srand()
using namespace std;

void uvodniKonverzace();
bool vyberPostavy();
bool uvodniVolbaHrace();
void vstupDoVesnice();
void obchodHercules();
void obchodMnich();
void pripravNaBoj();
void zacniBoj();

float zivoty = 5.0;
int utok = 3;
int zlato = 2;
int mana = 2;
float zkusenosti = 5.0;
int uvodniVolba;
int volbaPostavy;
int vesniceVolba;
int nakupVolba;
bool vObchode = true;
bool delovaRanaAktivni = false;
int kolaDeloveRany = 0;

void uvodniKonverzace() {
    cout << "Vitej ve hre Smrtelna vez.\n";
    cout << "Tvym ukolem je dostat se nahoru, kde sidli hlavni boss Vextile.\n";
    cout << "Ten utiskuje okolni vesnice a chrani ho 16 monster.\n";
    cout << "Mezi nimi jsou i dva mini bossove, bratri Vexove.\n";
    cout << "Musis je vsechny porazit a zachranit svet.\n\n";
    cout << "Za kazde monstrum ziskas zkusenosti, manu a zlato.\n";
    cout << "Ty pak pouzijes ve vesnici na vylepseni schopnosti.\n";
    cout << "Nyni si vyber jednu ze dvou postav za ktere budes hrat.\n";
}

bool vyberPostavy() {
    cout << "1. Postava:\n";
    cout << "- Jmeno: Herkules\n";
    cout << "- Zivoty: 5\n";
    cout << "- Mana: 2\n";
    cout << "- Zlato: 2\n";
    cout << "- Zkusenosti: 0\n";
    cout << "- Utok: 3\n";
    cout << "- Schopnost: Delova rana = Za 2 many bude mit na 2 nasledujici kola dvojnasobny utok\n\n";

    cout << "2. Postava:\n";
    cout << "- Jmeno: Mnich\n";
    cout << "- Zivoty: 5\n";
    cout << "- Mana: 2\n";
    cout << "- Zlato: 2\n";
    cout << "- Zkusenosti: 0\n";
    cout << "- Utok: 3\n";
    cout << "- Schopnost: Meditace = Za 2 many aktivuje meditaci. Po meditaci se pridaji 2 zivoty\n\n";

    cout << "Vyber si svou postavu:\n";
    cout << "Hercules: 1\n";
    cout << "Mnich: 2\n";
    cin >> volbaPostavy;

    if (volbaPostavy == 1) {
        cout << "Vybral sis Herculese\n";
        return true;
    } else if (volbaPostavy == 2) {
        cout << "Vybral sis Mnicha\n";
        return true;
    } else {
        cout << "Neplatna volba, hra se ukoncuje.\n";
        return false;
    }
}

bool uvodniVolbaHrace() {
    cout << "Jsi pripraven vydat se na svou cestu?\n";
    cout << "Pokracovat do vesnice: 1\n";
    cout << "Ukoncit hru: 2\n";
    cin >> uvodniVolba;

    if (uvodniVolba == 1) {
        return true;
    } else if (uvodniVolba == 2) {
        cout << "Rozhodl ses hru ukoncit. Mozna priste...\n";
        return false;
    } else {
        cout << "Neplatna volba, hra se ukoncuje.\n";
        return false;
    }
}

void vstupDoVesnice() {
    cout << "Vitej hrdino v nasi vesnici.\n";
    cout << "Toto je misto klidu a miru. Ale mimo vesnic jsou uzemi monster.\n";
    cout << "Jestli je chces porazit, musis se dobre pripravit.\n";
    cout << "Za zlato muzu vylepsit tvoje vlastnosti a za manu si vylepsis sve schopnosti.\n";
    cout << "Zlato ziskas z monster a manu z minibosu.\n";
    cout << "Rovnou si muzes neco koupit nez se vydas na cestu.\n\n";

    cout << "Tvoje statistiky:\n";
    cout << "Zivoty: " << zivoty << "\n";
    cout << "Utok: " << utok << "\n";
    cout << "Zlato: " << zlato << "\n";
    cout << "Mana: " << mana << "\n\n";

    cout << "Chces si neco koupit nebo jdes rovnou do boje?\n";
    cout << "Nakup: 1\n";
    cout << "Boj: 2\n";
    cin >> vesniceVolba;

    if (vesniceVolba == 1) {
        if (volbaPostavy == 1) {
            obchodHercules();
        } else if (volbaPostavy == 2) {
            obchodMnich();
        }
    } else if (vesniceVolba == 2) {
        pripravNaBoj();
    } else {
        cout << "Neplatna volba, hra se ukoncuje.\n";
    }
}

void obchodHercules() {
    vObchode = true;
    while (vObchode) {
        cout << "\nRozhodl ses pro nakup:\n";
        cout << "Zlato: " << zlato << " | Mana: " << mana << "\n";
        cout << "+1 utok: 1 zlato (1)\n";
        cout << "+1 zivot: 3 zlata (2)\n";
        cout << "Delova rana: 2 many (3)\n";
        cout << "Odejit z obchodu: (4)\n";
        cout << "Volba: ";
        cin >> nakupVolba;

        switch (nakupVolba) {
            case 1:
                if (zlato >= 1) {
                    utok += 1;
                    zlato -= 1;
                    cout << "Zvysil sis utok na " << utok << ".\n";
                } else {
                    cout << "Nemas dostatek zlata.\n";
                }
                break;
            case 2:
                if (zlato >= 3) {
                    zivoty += 1;
                    zlato -= 3;
                    cout << "Zivoty: " << zivoty << "\n";
                } else {
                    cout << "Nemas dostatek zlata.\n";
                }
                break;
            case 3:
                if (mana >= 2) {
                    delovaRanaAktivni = true;
                    kolaDeloveRany = 2;
                    mana -= 2;
                    cout << "Aktivoval jsi Delovou ranu! V dalsim boji budes mit dvojnasobny utok na 2 kola.\n";
                } else {
                    cout << "Nemas dostatek many.\n";
                }
                break;
            case 4:
                vObchode = false;
                pripravNaBoj();
                break;
            default:
                cout << "Neplatna volba.\n";
        }
    }
}

void obchodMnich() {
    vObchode = true;
    while (vObchode) {
        cout << "\nRozhodl ses pro nakup:\n";
        cout << "Zlato: " << zlato << " | Mana: " << mana << "\n";
        cout << "+1 utok: 1 zlato (1)\n";
        cout << "+1 zivot: 3 zlata (2)\n";
        cout << "Meditace (+2 zivoty): 2 many (3)\n";
        cout << "Odejit z obchodu: (4)\n";
        cout << "Volba: ";
        cin >> nakupVolba;

        switch (nakupVolba) {
            case 1:
                if (zlato >= 1) {
                    utok += 1;
                    zlato -= 1;
                    cout << "Zvysil sis utok na " << utok << ".\n";
                } else {
                    cout << "Nemas dostatek zlata.\n";
                }
                break;
            case 2:
                if (zlato >= 3) {
                    zivoty += 1;
                    zlato -= 3;
                    cout << "Zivoty: " << zivoty << "\n";
                } else {
                    cout << "Nemas dostatek zlata.\n";
                }
                break;
            case 3:
                if (mana >= 2) {
                    zivoty += 2;
                    mana -= 2;
                    cout << "Meditace dokoncena. Pridal sis 2 zivoty. Mas jich ted: " << zivoty << "\n";
                } else {
                    cout << "Nemas dostatek many.\n";
                }
                break;
            case 4:
                vObchode = false;
                pripravNaBoj();
                break;
            default:
                cout << "Neplatna volba.\n";
        }
    }
}

void pripravNaBoj() {
    cout << "\nRozhodl ses jit do boje, preju ti hodne stesti.\n";
    cout << "Cekaji te tri monstra a pote dorazis do dalsi vesnice.\n";
    cout << "Hodne stesti.\n";
    cout << "\nPravidla boje:\n";
    cout << "V souboji proti normalnimu monstru budes mit vyhodu, budes zacinat prvni.\n";
    cout << "Kazde kolo se rozhodujes mezi utokem a obranou.\n";
    cout << "Pokud zvolis utok uberes monstru tolik zivotu kolik mas v promnene utok, ale monstrum ti ubere 0,5.\n";
    cout << "Pokud zvolis obranu, zautocis jen polovinou sveho utoku, ale monstrum ti ubere jen 0,3.\n";
    cout << "Zakladni monstra vzdy jen utoci a muze z nich spadnout zlato a daji ti 0,25 zkusenosti.\n";
    cout << "Mini bossove a hlavni boss muzou zautocit i zvolit obranu jako ty. Z nich pada vzdy zlato, mana a 1 zksenost.\n";
    cout << "Za zkusenosti ziskas navic zivoty. Kdyz porazis hlavniho bosse ziskas i jeho poklad.\n";
    cout << "Zde jsou tve statistiky a statistiky monster prto kterym ted budes bojovat:.\n";
    cout << "Zivoty: " << zivoty << "\n";
    cout << "Utok: " << utok << "\n";
    cout << "Ted te cekaji 3 monstra postupne, pote prijdes do vesnice, pak te cekaji 4 monstra postupne, pak nasleduje vesnice.\n";
    cout << "Pote te cekaji 3 monstra postupne a pak budes bojovat proti trem monstrum najednou.\n";
    cout << "Pak nasleduje vesnice a za ni te ceka boj s dvema minibossy, pak dojdes do posledni vesnice a za ni je hlavni boss.\n";
    cout << "Zakladni mostra maji 6 zivotu a silu 0.6. \n";
    zacniBoj();


}
void zacniBoj() {
    for (int i = 1; i <= 3; i++) {
        cout << "\nBojujes s monstrem cislo " << i << "!\n";
        float zivotMonstra = 6.0;
        while (zivotMonstra > 0 && zivoty > 0) {
            int volba;
            cout << "\nZivoty: " << zivoty << " | Utok: " << utok << " | Zivoty monstra: " << zivotMonstra << "\n";
            cout << "Zvol akci:\n1. Utok (plny utok, monstrum ti ubere 0.5, utokem aktivujes delovou ranu pokud ji mas)\n2. Obrana (polovicni utok, monstrum ti ubere 0.3, obranou neaktivujes delovou ranu)\nVolba: ";
            cin >> volba;

            float aktualniUtok = utok;
            if (volba == 1) {
                if (volbaPostavy == 1 && delovaRanaAktivni && kolaDeloveRany > 0) {
                    aktualniUtok *= 2;
                    kolaDeloveRany--;
                    if (kolaDeloveRany == 0) delovaRanaAktivni = false;
                }
                zivotMonstra -= aktualniUtok;
                zivoty -= 0.5;
                cout << "Zautocil jsi za " << aktualniUtok << ". Monstrum ma " << (zivotMonstra > 0 ? zivotMonstra : 0) << " zivotu.\n";
                cout << "Monstrum te zranilo za 0.5. Mas " << zivoty << " zivotu.\n";
            } else if (volba == 2) {
                float obrannyUtok = aktualniUtok / 2.0;
                zivotMonstra -= obrannyUtok;
                zivoty -= 0.3;
                cout << "Zautocil jsi obrane za " << obrannyUtok << ". Monstrum ma " << (zivotMonstra > 0 ? zivotMonstra : 0) << " zivotu.\n";
                cout << "Monstrum te zranilo za 0.3. Mas " << zivoty << " zivotu.\n";
            } else {
                cout << "Neplatna volba, ztracis kolo!\n";
            }

            if (zivoty <= 0) {
                cout << "Byl jsi porazen. Konec hry.\n";
                exit(0);
            }
        }

        cout << "\nPorazil jsi monstrum!\n";
        zkusenosti += 0.25;

        if (zkusenosti >= 1.0) {
            zivoty += 1;
            zkusenosti -= 1.0;
            cout << "Ziskal jsi 1 zivot za zkusenosti. Mas " << zivoty << " zivotu.\n";
        }

        int drop = rand() % 100;  //Nová podmínka pro šanci že padne zlato s kombinací s drop()
        if (drop < 50) {
            int ziskaneZlato = (rand() % 2) + 1;
            zlato += ziskaneZlato;
            cout << "Ziskal jsi " << ziskaneZlato << " zlata z monstra!\n";
        } else {
            cout << "Monstrum nezanechalo zadne zlato.\n";
        }

        cout << "Celkem mas: " << zlato << " zlata, " << zkusenosti << " zkusenosti.\n";
    }

    cout << "\nPorazil jsi vsechna tri monstra! Pokracujes dal do dalsi vesnice.\n";
}



int main() {
    uvodniKonverzace();
    if (!vyberPostavy()) return 0;
    if (!uvodniVolbaHrace()) return 0;
    vstupDoVesnice();
    return 0;
}
